### Purchase & Cart API Testing

@baseUrl = http://localhost:5000/v1
@authToken = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OGE0MTkyY2NmNTlhNTI5MDM1MDg5NzkiLCJlbWFpbEFkZHJlc3MiOiJ0ZXN0QGdtYWlsLmNvbSIsInJvbGVzIjpbInVzZXIiXSwiaWF0IjoxNzU1NTg0ODQ5LCJleHAiOjE3NTU1ODg0NDl9.j-KoGyqF2dpP2soX_UbY_IrFLNuXPkjvlMYGi2gB8MQ

### 1. Get Purchase Service Status
GET {{baseUrl}}/purchase/self
Content-Type: application/json

### 2. Get User Cart
GET {{baseUrl}}/purchase/cart
Content-Type: application/json
Authorization: {{authToken}}

### 3. Add Product to Cart
POST {{baseUrl}}/purchase/cart/add
Content-Type: application/json
Authorization: {{authToken}}

{
  "productId": "68a143d794fd76d426560501"
}

### 4. Add Multiple Products to Cart
POST {{baseUrl}}/purchase/cart/add
Content-Type: application/json
Authorization: {{authToken}}

{
  "productId": "687949b3608bcf098a52e038"
}

### 5. Remove Product from Cart
DELETE {{baseUrl}}/purchase/cart/remove/68a143d794fd76d426560501
Content-Type: application/json
Authorization: {{authToken}}

### 6. Apply Promocode to Cart
POST {{baseUrl}}/purchase/cart/promocode
Content-Type: application/json
Authorization: {{authToken}}

{
  "code": "WELCOME10"
}

### 7. Apply Different Promocode
POST {{baseUrl}}/purchase/cart/promocode
Content-Type: application/json
Authorization: {{authToken}}

{
  "code": "SAVE20"
}

### 8. Apply Fixed Amount Promocode
POST {{baseUrl}}/purchase/cart/promocode
Content-Type: application/json
Authorization: {{authToken}}

{
  "code": "NEWUSER"
}

### 9. Apply Black Friday Promocode
POST {{baseUrl}}/purchase/cart/promocode
Content-Type: application/json
Authorization: {{authToken}}

{
  "code": "BLACKFRIDAY"
}

### 10. Remove Applied Promocode
DELETE {{baseUrl}}/purchase/cart/promocode
Content-Type: application/json
Authorization: {{authToken}}

### 11. Create Purchase from Cart (Free Products)
POST {{baseUrl}}/purchase/create
Content-Type: application/json
Authorization: {{authToken}}

{
  "paymentMethod": "free",
  "paymentReference": "free-access"
}

### 12. Create Purchase from Cart (Paid Products)
POST {{baseUrl}}/purchase/create
Content-Type: application/json
Authorization: {{authToken}}

{
  "paymentMethod": "stripe",
  "paymentReference": "pi_1234567890"
}

### 13. Create Purchase with Manual Payment
POST {{baseUrl}}/purchase/create
Content-Type: application/json
Authorization: {{authToken}}

{
  "paymentMethod": "manual",
  "paymentReference": "manual-payment-123"
}

### 14. Clear Cart
DELETE {{baseUrl}}/purchase/cart/clear
Content-Type: application/json
Authorization: {{authToken}}

### 15. Get User Purchases (All)
GET {{baseUrl}}/purchase/my-purchases?page=1&limit=10
Content-Type: application/json
Authorization: {{authToken}}

### 16. Get User Purchases (Prompts Only)
GET {{baseUrl}}/purchase/my-purchases?page=1&limit=5&type=prompt
Content-Type: application/json
Authorization: {{authToken}}

### 17. Get User Purchases (Automations Only)
GET {{baseUrl}}/purchase/my-purchases?page=1&limit=5&type=automation
Content-Type: application/json
Authorization: {{authToken}}

### 18. Get User Purchases (Agents Only)
GET {{baseUrl}}/purchase/my-purchases?page=1&limit=5&type=agent
Content-Type: application/json
Authorization: {{authToken}}

### 19. Get User Purchases by Type (Card View)
GET {{baseUrl}}/purchase/my-purchases/by-type
Content-Type: application/json
Authorization: {{authToken}}

### 20. Get Product Premium Content Access
GET {{baseUrl}}/purchase/access/68a143d794fd76d426560501
Content-Type: application/json
Authorization: {{authToken}}

### 21. Add Multiple Products and Apply Promocode Workflow
POST {{baseUrl}}/purchase/cart/add
Content-Type: application/json
Authorization: {{authToken}}

{
  "productId": "687949b3608bcf098a52e037"
}

###
POST {{baseUrl}}/purchase/cart/add
Content-Type: application/json
Authorization: {{authToken}}

{
  "productId": "687949b3608bcf098a52e038"
}

###
POST {{baseUrl}}/purchase/cart/promocode
Content-Type: application/json
Authorization: {{authToken}}

{
  "code": "SAVE20"
}

###
GET {{baseUrl}}/purchase/cart
Content-Type: application/json
Authorization: {{authToken}}

###
POST {{baseUrl}}/purchase/create
Content-Type: application/json
Authorization: {{authToken}}

{
  "paymentMethod": "stripe",
  "paymentReference": "pi_workflow_test"
}

### 22. Test Invalid Promocode
POST {{baseUrl}}/purchase/cart/promocode
Content-Type: application/json
Authorization: {{authToken}}

{
  "code": "INVALID_CODE"
}

### 23. Test Adding Own Product to Cart (Should Fail)
POST {{baseUrl}}/purchase/cart/add
Content-Type: application/json
Authorization: {{authToken}}

{
  "productId": "YOUR_OWN_PRODUCT_ID"
}

### 24. Test Adding Already Purchased Product to Cart (Should Fail)
POST {{baseUrl}}/purchase/cart/add
Content-Type: application/json
Authorization: {{authToken}}

{
  "productId": "ALREADY_PURCHASED_PRODUCT_ID"
}

### 25. Test Empty Cart Purchase (Should Fail)
POST {{baseUrl}}/purchase/create
Content-Type: application/json
Authorization: {{authToken}}

{
  "paymentMethod": "stripe",
  "paymentReference": "pi_empty_cart_test"
}

### 26. Complete Payment (Simulate Payment Success)
POST {{baseUrl}}/purchase/complete-payment
Content-Type: application/json

{
  "purchaseId": "68a41a0ecf59a529035089b0"
}

### 27. Complete Payment for Different Purchase
POST {{baseUrl}}/purchase/complete-payment
Content-Type: application/json

{
  "purchaseId": "YOUR_PURCHASE_ID_HERE"
}

### 28. User Confirm Payment (Authenticated)
POST {{baseUrl}}/purchase/confirm-payment
Content-Type: application/json
Authorization: {{authToken}}

{
  "purchaseId": "68a41a0ecf59a529035089b0",
  "paymentMethod": "credit_card",
  "transactionId": "manual-cc-123456"
}

### 29. Complete Purchase Workflow (Create -> Complete Payment)
POST {{baseUrl}}/purchase/cart/add
Content-Type: application/json
Authorization: {{authToken}}

{
  "productId": "68a143d794fd76d426560501"
}

###
POST {{baseUrl}}/purchase/create
Content-Type: application/json
Authorization: {{authToken}}

{
  "paymentMethod": "credit_card",
  "paymentReference": "workflow-test"
}

###
POST {{baseUrl}}/purchase/complete-payment
Content-Type: application/json

{
  "purchaseId": "PURCHASE_ID_FROM_ABOVE_RESPONSE"
}

### 30. Access Premium Content After Purchase
GET {{baseUrl}}/purchase/access/68a143d794fd76d426560501
Content-Type: application/json
Authorization: {{authToken}}

### 31. Test Double Payment Completion (Should Fail)
POST {{baseUrl}}/purchase/complete-payment
Content-Type: application/json

{
  "purchaseId": "ALREADY_COMPLETED_PURCHASE_ID"
}